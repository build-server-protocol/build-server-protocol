# Contributing

Firstly, thanks for taking the time to contribute! Here's hopefully some helpful
info to get you started.

## Before Adding a Feature

Before a new feature or endpoint is added to this repo you'll want to make sure
that there is agreement amongst the main parties using BSP. In order for this to
happen it's always preferred that you make sure there is an
[Issue](https://github.com/build-server-protocol/build-server-protocol/issues)
or a
[Discussion](https://github.com/build-server-protocol/build-server-protocol/discussions/landing)
started before you start working on your new feature. With that in mind, we also
understand that sometimes it's easier to just hack something in to show what
you're trying to do. If that's the case, don't hesitate and feel free to create
a draft PR explaining the feature. This will ensure everyone is on the same
page, and provide you with the best contributing experience. It also helps keep
the maintainers on the same page about what's happening.

NOTE: If you're just making a fix or a small improvement on something, it's not
necessary to have an issue or discussion first.

## Updating the protocol

To change the protocol (e.g. by adding a new field to some request parameters), one has to update
the [Smithy](https://smithy.io/2.0/index.html) model.
The model is located in the [spec/src/main/resources/META-INF/smithy/bsp](spec/src/main/resources/META-INF/smithy/bsp) folder.
The model is then used to generate the protocol specification, the documentation and the support libraries.
Support libraries can be generated by running `bazel run generate`.

## Formatting

Formatting will happen as a part of the generation process

## Releasing

TODO

## Building the docs

The docs for this site are build with [mdoc](https://scalameta.org/mdoc/) to
typecheck Scala snippets and also to generate a static site via
[Docusaurus](https://docusaurus.io/).

To build the site locally you'll want to follow the below steps:

1. `bazel run //website:docusaurus-start` to start the site locally
2. (optionally) `cd website && pnpm install` to install the dependencies (needed only for IDE support)

### Approval tests

Upon committing changes to the protocol specification, a test is run to ensure that the generated
protocol specification is identical to the committed one.
If the test fails, please run `bazel run generate` and commit the changes.

## Some notes on maintenance

As BSP is becoming more popular and widely used, it's important that all the main
parties involved come to an agreement on what is going to be added and merge
into the protocol. In order to ensure this happen we have a [feature request
template](./.github/ISSUE_TEMPLATE/feature_request.yml) that will have a section
that each party can check making it clear that everyone is on the same page.
When a PR is created, the [CODEOWNERS](./.github/CODEOWNERS) file will ensure
that one person from each party is also assigned to review. This person can
either review or tag someone more relevant on their team. In order to keep a
timely review process, if no one from the team is heard from for 2 weeks, it's
assumed that everyone is on board with the changes.

### Main Parties Involved

These are the main parties involved in the maintenance of this repo and protocol.

- [JetBrains](https://www.jetbrains.com/)
- [Metals Team](https://github.com/scalameta)
- [Scala Center](https://scala.epfl.ch/)
